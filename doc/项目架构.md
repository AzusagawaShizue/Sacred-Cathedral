# Pray1209 技术架构白皮书

## 1. 核心模块拆解 (Module Breakdown)

项目主要分为四大板块：**智能合约层**、**后端服务层**、**前端交互层**、**数据索引与存储层**。

### A. 智能合约层 (Smart Contracts) - "法律与资产"
这是项目的核心，负责资产发行和核心逻辑结算。
*   **$GRACE 代币合约 (ERC-20):** 处理代币铸造、销毁、转账。
*   **素材/消耗品合约 (ERC-1155):** 管理木头、蜡烛、经文残页等大量道具。
*   **珍稀圣物合约 (ERC-721):** 管理成品圣物，支持 Metadata 动态更新（铭刻功能）。
*   **祭坛容器合约 (ERC-6551):** (进阶) 为每个祭坛 NFT 生成钱包地址。
*   **主逻辑合约 (Gameplay Facet):**
    *   **合成系统 (The Foundry):** 接收 ERC-1155 + ERC-20 -> 铸造 ERC-721。
    *   **捐赠库 (Charity Vault):** 自动分账逻辑，DAO 资金归集。

### B. 后端服务层 (Backend & Relayer) - "裁判与桥梁"
负责处理高频请求、防止作弊、以及代付 Gas。
*   **Game Server (API):**
    *   **祈祷逻辑:** 校验用户点击频率，计算掉落（RNG），更新用户每日精神力。
    *   **临时库存:** 用户点击获得的普通素材先存在数据库中，只有用户选择“提现”时才上链。
*   **Relayer & Paymaster (Gas 代付):**
    *   如果采用 ERC-4337 (账户抽象)，需要部署或接入 Bundler 和 Paymaster 服务，实现用户无感交互。
*   **Verifiable Random Function (VRF):**
    *   对接 Chainlink VRF 或 Pyth，确保传说级物品掉落的随机数是公正不可篡改的。

### C. 前端交互层 (Frontend Client) - "圣殿"
*   **3D 渲染引擎:** 使用 Three.js / React-Three-Fiber 渲染悬浮的圣物、粒子光效。
*   **Web3 接入层:** 集成 Wagmi / RainbowKit，处理钱包连接、签名。
*   **UI 组件库:** 祭坛拖拽编辑器、排行榜展示、背包管理。

### D. 数据索引与存储层 (Indexer & Storage) - "书记员"
*   **NFT Metadata 存储:** 圣物的图片、属性描述文件。
*   **链上数据索引:** 实时抓取链上数据（谁买了什么，DAO 资金池有多少钱），提供给前端查询，比直接查节点快得多。

---

## 2. 智能合约标准与资产协议 (Protocol Standards)

本章节详细定义了 Pray1209 生态系统中不同类型数字资产所采用的以太坊标准（ERC Standards）。

### 2.1 ERC-20: 生态流通货币 ($GRACE)
*   **定义:** 同质化代币标准。
*   **应用场景:** 祈祷产出、购买消耗品、合成支付、DAO 捐赠。
*   **特性:** 包含 `burn` (销毁) 功能，用于通缩机制。

### 2.2 ERC-1155: 基础素材库 (Materials)
*   **对应资产:** 木头、蜡烛、经文残页。
*   **核心理由:** 允许在单个合约中管理多种代币，支持 **批量操作 (Batch Transfer)**，极大降低高频交互的 Gas 费。用户背包中显示为堆叠物品。

### 2.3 ERC-721: 稀有圣物 (Relics)
*   **对应资产:** 传说级圣物、铭刻后的成品、头像。
*   **核心理由:** 强调 **唯一性**。每个 Token 拥有独立的 `TokenID` 和 Metadata，记录其生成日期、铭刻内容和独特特效。

### 2.4 进阶协议 (Advanced)
*   **ERC-6551 (Token Bound Accounts):**
    *   **应用:** **个人祭坛**。祭坛本身是一个 NFT，但它拥有自己的钱包地址。用户获得的圣物可以“存入”祭坛 NFT 中，实现整套祭坛的打包交易。
*   **EIP-5192 (SBT):**
    *   **应用:** **虔诚度证明**。不可转让的代币，记录用户的修行成就，作为 DAO 治理权重的依据，防止鲸鱼垄断。
*   **ERC-4337 (Account Abstraction):**
    *   **应用:** **无感登录**。支持社交账号登录和 Gas 代付，降低 Web2 用户门槛。

---

## 3. 网络选型与基础设施 (Network Selection)

### 3.1 方案对比

| 特性 | Ethereum (L1) | Arbitrum (L2) | **Base (L2)** | BSC (L1) |
| :--- | :--- | :--- | :--- | :--- |
| **交互成本** | 极高 ($2-$50+) | 低 ($0.01-$0.1) | **极低 ($0.001-$0.05)** | 极低 |
| **安全性** | 最高 | 高 | **高** | 中 |
| **生态氛围** | 贵族/金融 | DeFi/GameFi | **消费/社交/艺术** | 博彩/土狗 |
| **适用性** | 不推荐 | 稳健选择 | **最佳推荐** | 慎选 |

### 3.2 最终建议：Base + 混合上链策略

**首选网络：Base**
*   **理由:** 背靠 Coinbase，用户门槛低（Smart Wallet），Gas 费极低（EIP-4844 后），且生态氛围偏向文化与创作者经济，与“数字修行”主题高度契合。

**混合上链策略 (Hybrid Strategy):**
1.  **祈祷 (Mining):** **不需上链。** 点击交互在中心化数据库记录，体验流畅无感。
2.  **提现/铸造 (Claiming):** **上链。** 用户积累一定资源后，手动选择“Mint”上链，支付一次 Gas。
3.  **合成 (Crafting):** **必须上链。** 价值交换的关键时刻，确权并销毁旧资产。

---

## 4. 部署架构方案 (Deployment Strategy)

推荐采用 **Serverless + Layer 2** 的现代 Web3 架构。

| 模块 | 推荐技术栈 | 部署位置/服务商 |
| :--- | :--- | :--- |
| **智能合约** | Solidity, Hardhat/Foundry | **Base Mainnet** |
| **前端代码** | React, Next.js, Vite | **Vercel** |
| **后端 API** | NestJS / Serverless | **Vercel Functions** |
| **数据库** | PostgreSQL | **Supabase** |
| **存储** | IPFS | **Pinata** |
| **索引** | The Graph | **The Graph (Hosted)** |

---

## 5. 开发路线图 (Roadmap)

### 阶段 1: 创世基石 (Genesis Foundation)
*   完成 ERC-20, 1155, 721 合约开发。
*   实现“合成配方”逻辑。
*   搭建基础数据库。

### 阶段 2: 圣殿搭建 (Sanctuary Construction)
*   前端 3D 祈祷场景实现。
*   Web3 钱包集成。
*   个人祭坛编辑器开发。

### 阶段 3: 内部测试网 (Alpha Testnet)
*   部署至 Base Sepolia 测试网。
*   搭建 The Graph 索引。
*   种子用户测试与数值调整。

### 阶段 4: 安全审计与预热 (Audit & Pre-launch)
*   智能合约审计 (CertiK/SlowMist)。
*   白名单活动与社区预热。

### 阶段 5: 正式上线 (Mainnet Launch)
*   主网部署。
*   开启 Genesis Mint 和代币流动性。
