## 1. 核心模块拆解 (Module Breakdown)

项目主要分为四大板块：**智能合约层**、**后端服务层**、**前端交互层**、**数据索引与存储层**。

### A. 智能合约层 (Smart Contracts) - "法律与资产"
这是项目的核心，负责资产发行和核心逻辑结算。
*   **$GRACE 代币合约 (ERC-20):** 处理代币铸造、销毁、转账。
*   **素材/消耗品合约 (ERC-1155):** 管理木头、蜡烛、经文残页等大量道具。
*   **珍稀圣物合约 (ERC-721):** 管理成品圣物，支持 Metadata 动态更新（铭刻功能）。
*   **祭坛容器合约 (ERC-6551):** (进阶) 为每个祭坛 NFT 生成钱包地址。
*   **主逻辑合约 (Gameplay Facet):**
    *   **合成系统 (The Foundry):** 接收 ERC-1155 + ERC-20 -> 铸造 ERC-721。
    *   **捐赠库 (Charity Vault):** 自动分账逻辑，DAO 资金归集。

### B. 后端服务层 (Backend & Relayer) - "裁判与桥梁"
负责处理高频请求、防止作弊、以及代付 Gas。
*   **Game Server (API):**
    *   **祈祷逻辑:** 校验用户点击频率，计算掉落（RNG），更新用户每日精神力。
    *   **临时库存:** 用户点击获得的普通素材先存在数据库中，只有用户选择“提现”时才上链。
*   **Relayer & Paymaster (Gas 代付):**
    *   如果采用 ERC-4337 (账户抽象)，需要部署或接入 Bundler 和 Paymaster 服务，实现用户无感交互。
*   **Verifiable Random Function (VRF):**
    *   对接 Chainlink VRF 或 Pyth，确保传说级物品掉落的随机数是公正不可篡改的。

### C. 前端交互层 (Frontend Client) - "圣殿"
*   **3D 渲染引擎:** 使用 Three.js / React-Three-Fiber 渲染悬浮的圣物、粒子光效。
*   **Web3 接入层:** 集成 Wagmi / RainbowKit，处理钱包连接、签名。
*   **UI 组件库:** 祭坛拖拽编辑器、排行榜展示、背包管理。

### D. 数据索引与存储层 (Indexer & Storage) - "书记员"
*   **NFT Metadata 存储:** 圣物的图片、属性描述文件。
*   **链上数据索引:** 实时抓取链上数据（谁买了什么，DAO 资金池有多少钱），提供给前端查询，比直接查节点快得多。

---

## 2. 部署架构方案 (Deployment Strategy)

推荐采用 **Serverless + Layer 2** 的现代 Web3 架构。

| 模块 | 推荐技术栈 | 部署位置/服务商 | 备注 |
| :--- | :--- | :--- | :--- |
| **智能合约** | Solidity, Hardhat/Foundry | **Base Mainnet** (首选) 或 Arbitrum | 需在 Etherscan/Basescan 开源验证代码。 |
| **前端代码** | React, Next.js, Vite | **Vercel** 或 Netlify | 利用其全球 CDN 加速加载 3D 资源。 |
| **后端 API** | Node.js (NestJS) 或 Serverless Functions | **Vercel Functions** 或 AWS Lambda | Serverless 成本低，随流量自动扩容。 |
| **数据库** | PostgreSQL | **Supabase** 或 AWS RDS | 存储用户链下积分、精神力、个人配置。 |
| **图片/元数据** | IPFS | **Pinata** 或 Arweave | 确保 NFT 资产永久存储，去中心化。 |
| **数据索引** | The Graph / GhostGraph | **The Graph (Hosted Service)** | 编写 Subgraph 监听链上事件。 |
| **账户抽象** | ERC-4337 SDK | **Pimlico** 或 ZeroDev | 提供 Bundler 和 Paymaster 基础设施。 |

---

## 3. 开发到上线的关键节点 (Roadmap & Milestones)

我们将项目周期分为 **5 个阶段 (Sprints)**，预计周期 3-5 个月。

### 阶段 1: 创世基石 (Genesis Foundation) - [约 3 周]
*   **目标:** 完成所有智能合约的编写与单元测试。
*   **任务:**
    *   [合约] 编写 ERC-20, 1155, 721 基础合约。
    *   [合约] 编写“合成配方”逻辑。
    *   [测试] 在本地环境 (Hardhat Network) 模拟 1000 次合成，测试 Gas 消耗。
    *   [后端] 搭建基础数据库（User 表, Inventory 表）。

### 阶段 2: 圣殿搭建 (Sanctuary Construction) - [约 4 周]
*   **目标:** 前端视觉实现与 Web3 连接。
*   **任务:**
    *   [前端] 实现首页“点击祈祷”的 3D 动画与音效（核心体验）。
    *   [前端] 完成“个人祭坛”的 2D 拖拽编辑功能。
    *   [集成] 对接 Wagmi/RainbowKit，实现钱包登录。
    *   [后端] 开发“每日精神力”重置接口和防刷逻辑。

### 3. 阶段 3: 内部测试网 (Alpha Testnet) - [约 2 周]
*   **目标:** 跑通“点击 -> 掉落 -> 合成”的全流程。
*   **任务:**
    *   [部署] 将合约部署到 **Base Sepolia (测试网)**。
    *   [索引] 搭建 The Graph Subgraph，前端能读取到链上合成历史。
    *   [测试] 邀请 50 名种子用户（Discord 核心成员）进行测试，寻找 Bug。
    *   [优化] 根据测试网反馈，调整掉落概率和合成消耗数值。

### 阶段 4: 安全审计与预热 (Audit & Pre-launch) - [约 3 周]
*   **目标:** 确保资金安全，建立社区期待。
*   **任务:**
    *   **[关键] 智能合约审计:** 提交给审计公司（如 CertiK, SlowMist）或进行社区赏金计划 (Bug Bounty)。**DAO 资金库合约必须审计。**
    *   [资源] 将最终版 NFT 图片上传至 IPFS。
    *   [运营] 开启白名单 (Allowlist) 活动，发放“创世祈祷者”身份。

### 阶段 5: 正式上线 (Mainnet Launch & TGE) - [里程碑]
*   **目标:** 资产上链，开启经济循环。
*   **任务:**
    *   **Day 1:** 部署主网合约，开启 Genesis NFT Mint。
    *   **Day 7:** 开启 $GRACE 代币流动性池 (Uniswap)。
    *   **Day 30:** 开启首次 DAO 投票（决定第一笔慈善捐赠去向）。

---

## 4. 特别注意：混合上链策略 (Hybrid Strategy)

为了让项目顺畅运行，请务必在开发中遵循此策略：

1.  **祈祷 (Mining):** **不需上链。**
    *   用户点击是在前端与后端数据库交互。每点击一次，数据库记录 `+1 Wood`。
    *   用户体验：极快，无 Gas，无弹窗。
2.  **提现/铸造 (Claiming):** **上链。**
    *   当用户凑齐 100 个木头，想去市场上卖，或者想合成时，点击“Mint to Wallet”。
    *   此时调用合约，用户支付 Gas（或由项目方补贴），数据库扣除 100 木头，链上生成 100 ERC-1155 Token。
3.  **合成 (Crafting):** **必须上链。**
    *   这是价值交换的关键时刻，必须在链上确权，销毁旧资产，生成新资产。